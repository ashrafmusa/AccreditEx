# Firebase Firestore Data Import - Complete Setup Instructions

## âœ… What We've Done

1. **Deleted all collections** from Firestore using Firebase CLI
   - Command: `firebase firestore:delete --all-collections --force`
   - Status: âœ… **COMPLETE**

2. **Cleaned database ready for fresh setup**
   - Project: `accreditex-79c08`
   - Collections removed: appSettings, projects, risks, users, documents, etc.
   - Status: âœ… **COMPLETE** (26 documents deleted)

## ğŸ“‹ Firestore Structure (After Setup)

### Collections to Create:

```
accreditex-79c08 (Firestore Database)
â”œâ”€â”€ users/                    (12 documents)
â”‚   â”œâ”€â”€ user-1 (Ashraf Musa - Admin)
â”‚   â”œâ”€â”€ user-2 (Marcus Thorne - Project Lead)
â”‚   â”œâ”€â”€ user-3 (Lena Petrova - Team Member)
â”‚   â”œâ”€â”€ ... 9 more users
â”‚   â””â”€â”€ user-12 (Robert Brown - Team Member)
â”‚
â””â”€â”€ appSettings/              (1 document)
    â””â”€â”€ default (Global app settings)
```

## ğŸš€ Setup Instructions

### Prerequisites

1. **Firebase CLI installed** âœ…
2. **Firebase project access** âœ… (accreditex-79c08)
3. **Firebase credentials** (from environment variables)

### Step 1: Verify Environment Variables

Check your `.env` or `.env.local` file has these Firebase credentials:

```bash
VITE_FIREBASE_API_KEY=<your_api_key>
VITE_FIREBASE_AUTH_DOMAIN=<your_auth_domain>
VITE_FIREBASE_PROJECT_ID=accreditex-79c08
VITE_FIREBASE_STORAGE_BUCKET=<your_storage_bucket>
VITE_FIREBASE_MESSAGING_SENDER_ID=<your_messaging_sender_id>
VITE_FIREBASE_APP_ID=<your_app_id>
```

**To get these values:**
1. Go to [Firebase Console](https://console.firebase.google.com)
2. Select project `accreditex-79c08`
3. Click Project Settings (âš™ï¸ icon)
4. Under "Your apps", click the Web app
5. Copy the configuration values

### Step 2: Run the Import Script

Navigate to the project root and run:

```bash
node scripts/importFirestoreData.mjs
```

**Expected Output:**
```
ğŸš€ Firebase Firestore Data Import Script

ğŸ“ Project ID: accreditex-79c08
ğŸ” Auth Domain: accreditex-79c08.firebaseapp.com

ğŸ“¥ Starting data import...

ğŸ‘¥ Importing users collection...
   Imported 12/12 users...
âœ… Successfully imported 12 users

âš™ï¸  Importing appSettings...
âœ… Successfully imported appSettings

ğŸ‰ Data import process completed!

ğŸ“Š Next steps:
   1. Verify data in Firebase Console
   2. Create composite indexes (see COMPOSITE_INDEXES_GUIDE.md)
   3. Run the application: npm run dev
   4. Check Usage Monitor in Settings for usage stats
```

### Step 3: Verify Data in Firebase Console

1. Open [Firebase Console](https://console.firebase.google.com)
2. Select project `accreditex-79c08`
3. Go to **Firestore Database** section
4. You should see:
   - âœ… **users** collection with 12 documents
   - âœ… **appSettings** collection with 1 document

### Step 4: Create Composite Indexes

**IMPORTANT**: Without these indexes, your app will work but be inefficient.

See `COMPOSITE_INDEXES_GUIDE.md` for detailed instructions. Quick summary:

1. Go to Firestore Database in Firebase Console
2. Click **Indexes** tab
3. Create these **HIGH priority** indexes:
   - `projects: +status, +createdAt`
   - `projects: +departmentId, +status`
   - `users: +departmentId, +role`
   - `documents: +type, +status, +createdAt`

4. Create **MEDIUM priority** indexes as needed
5. Estimated time: 5-15 minutes per index

### Step 5: Test the Application

```bash
npm run dev
```

Then navigate to:
- **Login** with any user account (or create new)
- **Settings** â†’ **Usage Monitor** to see real-time Firestore usage
- Verify all data loads correctly

## ğŸ“Š Expected Results After Setup

### Collections Created
- âœ… `users` - 12 documents
- âœ… `appSettings` - 1 document (global settings)

### Read Count on Import
- Import operation: ~15 read operations (for verification)
- Negligible impact on free tier (50K reads/day limit)

### Storage Used
- Users: ~45 KB
- AppSettings: ~2 KB
- **Total**: ~50 KB (well within 1 GB limit)

## ğŸ”§ Troubleshooting

### Issue 1: "Permission denied" on import
**Cause**: Firestore security rules blocking the operation  
**Solution**: 
- Temporarily set rules to public for testing:
  ```
  match /{document=**} {
    allow read, write: if true;
  }
  ```
- Import data
- Restore production rules from `firestore.rules`

### Issue 2: Script can't find data files
**Cause**: Import script run from wrong directory  
**Solution**: 
- Always run from project root: `node scripts/importFirestoreData.mjs`
- Not from `scripts/` directory

### Issue 3: Firebase credentials not found
**Cause**: `.env` or `.env.local` missing Firebase config  
**Solution**:
- Copy `.env.example` to `.env.local`
- Fill in all Firebase credentials from Console
- Restart dev server

### Issue 4: "Cannot access admin resources"
**Cause**: Using web SDK without authenticated user  
**Solution**: 
- Sign in first, then import
- Or temporarily modify firestore.rules to allow unauthenticated writes

## ğŸ” Security Considerations

### Production Firestore Rules
The current `firestore.rules` file provides:
- âœ… User authentication required for all reads
- âœ… Admin-only writes for sensitive collections
- âœ… Role-based access control (Admin, ProjectLead, TeamMember)
- âœ… Project team member restrictions

### Before Going Live
1. âœ… Review and test `firestore.rules`
2. âœ… Create all composite indexes
3. âœ… Test all CRUD operations with different user roles
4. âœ… Monitor usage with `Usage Monitor` page
5. âœ… Set up billing alerts in Firebase Console

## ğŸ“ˆ Free Tier Usage Tracking

After setup, check **Settings â†’ Usage Monitor** to see:
- Daily reads/writes (limit: 50K reads/day, 20K writes/day)
- Monthly projected usage
- Estimated cost
- Warning when approaching limits

**Expected usage pattern:**
- Imports: ~50 reads
- Daily operations (optimized): 100-500 reads/day
- Monthly cost: $0 (free tier compliant)

## ğŸ¯ Next Steps

### Immediate (Required)
1. âœ… Run import script
2. âœ… Verify data in Firebase Console
3. âœ… Create composite indexes (HIGH priority first)
4. âœ… Test application

### Short-term (Recommended)
1. â³ Create remaining composite indexes (MEDIUM priority)
2. â³ Set up Firebase monitoring alerts
3. â³ Test error scenarios
4. â³ Review security rules with team

### Medium-term (Nice-to-have)
1. â³ Complete Phase 10: CI/CD & Advanced Monitoring
2. â³ Setup GitHub Actions workflows
3. â³ Configure Sentry for error tracking
4. â³ Enable Firebase Performance Monitoring

## ğŸ“š Reference Documentation

- **Setup Guide**: This file
- **Best Practices**: `FIREBASE_BEST_PRACTICES.md`
- **Composite Indexes**: `COMPOSITE_INDEXES_GUIDE.md`
- **Phase Completion**: `PHASES_4-9_COMPLETION_REPORT.md`
- **Security Rules**: `firestore.rules`
- **Configuration**: `firebase/firebaseConfig.ts`

## ğŸš¨ Important Notes

1. **Firestore Index Creation**: Required for optimal performance
   - Must be created manually in Firebase Console
   - Takes 5-15 minutes per index
   - One-time setup

2. **Free Tier Limits**: Application designed to stay within limits
   - 50K reads/day (optimized to ~100-500 with caching)
   - 20K writes/day (typical usage ~50-200)
   - $0/month cost

3. **Offline Support**: Enabled by default
   - IndexedDB caching reduces reads by 60-80%
   - Works without internet connection
   - Syncs when reconnected

4. **Backup Strategy**: Not yet implemented
   - Plan: Weekly exports to Cloud Storage
   - Or: Use Firestore automated backups (GCP)

---

**Status**: âœ… Database cleaned, ready for import  
**Last Updated**: December 2, 2025  
**Firebase Project**: accreditex-79c08  
**Firestore Database**: (default)
