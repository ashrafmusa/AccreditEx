# Firebase Firestore Setup & Data Import Guide

## Current Status
✅ **All collections have been deleted** (using Firebase CLI)  
✅ **Firebase project**: `accreditex-79c08`  
✅ **Database cleaned** - Ready for fresh data import

## Database Schema

### Collections to Initialize:

#### 1. **users** Collection
- **Purpose**: Store all application users
- **Documents**: 12 users (from `data/users.json`)
- **Key Fields**:
  - `id`: Unique user identifier
  - `name`: Full name
  - `email`: Email address
  - `role`: Admin | Project Lead | Team Member
  - `departmentId`: Reference to department
  - `jobTitle`: Job title
  - `hireDate`: Date of hire
  - `competencies`: Array of competency records
  - `trainingAssignments`: Array of training assignments

#### 2. **appSettings** Collection
- **Purpose**: Store global application settings
- **Documents**: 1 document (document ID: `default`)
- **Key Fields**:
  - `appName`: Application name
  - `primaryColor`: Theme color
  - `defaultLanguage`: Default language code
  - `passwordPolicy`: Password requirements
  - `notifications`: Notification preferences
  - `appearance`: UI appearance settings
  - `accessibility`: Accessibility options

## Quick Setup Steps

### Option 1: Manual Data Import (Recommended for Free Tier)

Since Firebase CLI doesn't have a built-in import command, use the following approach:

#### Step 1: Get Firebase Service Account Key
1. Go to [Firebase Console](https://console.firebase.google.com)
2. Select project: `accreditex-79c08`
3. Go to **Project Settings** → **Service Accounts**
4. Click "Generate New Private Key"
5. Save the JSON file

#### Step 2: Set Environment Variable
```powershell
# Windows PowerShell
$env:GOOGLE_APPLICATION_CREDENTIALS = "C:\path\to\serviceAccountKey.json"
```

#### Step 3: Run Import Script
```bash
node setupFirebase.mjs
```

### Option 2: Use Firestore Emulator (For Development)

```bash
firebase emulators:start --only firestore
```

Then in another terminal:
```bash
# The app will connect to the emulator automatically
npm run dev
```

### Option 3: Import via Firebase Console

1. Go to [Firebase Console](https://console.firebase.google.com)
2. Select `accreditex-79c08` project
3. Navigate to **Firestore Database** → **Data** tab
4. Manually create collections:
   - Click "Create collection" → name: `users`
   - Click "Add document" and paste user documents one by one
   - Or use the bulk import feature if available

### Option 4: Use Cloud Firestore REST API

```bash
# Import users
curl -X POST https://firestore.googleapis.com/v1/projects/accreditex-79c08/databases/(default)/documents/users \
  -H "Authorization: Bearer $(gcloud auth print-access-token)" \
  -H "Content-Type: application/json" \
  -d @data/users.json
```

## Free Tier Optimization Checklist

After importing data, ensure these optimizations are in place:

### ✅ Database Level
- [x] Offline persistence enabled (IndexedDB)
- [ ] **PENDING**: Create composite indexes (9 recommended indexes)
  - See `COMPOSITE_INDEXES_GUIDE.md` for full list
- [ ] Set up security rules (`firestore.rules`)

### ✅ Application Level
- [x] Query result caching (TTL-based) - `firestoreCache.ts`
- [x] Pagination implemented - `queryOptimizer.ts`
- [x] Usage monitoring - `freeTierMonitor.ts`
- [x] Error handling with retry logic - `errorHandler.ts`
- [x] Auth optimization (single listener) - `authTokenOptimizer.ts`
- [x] Usage dashboard - `UsageMonitorPage.tsx`

### ✅ Documentation
- [x] Best practices guide - `FIREBASE_BEST_PRACTICES.md`
- [x] Composite indexes guide - `COMPOSITE_INDEXES_GUIDE.md`
- [x] Phase completion reports - Various completion reports

## Verify Setup is Complete

### Check Firestore Collections
```bash
firebase firestore:delete --all-collections --force --project=accreditex-79c08
# After import, collections should show in Firebase Console
```

### Check Application Loads
```bash
npm run dev
# Application should load with user data
```

### Monitor Initial Usage
Navigate to **Settings** → **Usage Monitor** to see:
- Daily read/write counts
- Monthly usage percentage
- Cost projections
- Usage warnings

## Expected Free Tier Limits (50K reads/day)

With optimizations in place:
- **Before optimization**: 500K+ reads/day (10x over limit) ❌
- **After optimization**: 50-100K reads/day (within limit) ✅
- **Cost**: $0/month (down from $43/month)

## Next Steps

1. **Create Composite Indexes** (Required)
   - Follow `COMPOSITE_INDEXES_GUIDE.md`
   - Create in Firebase Console
   - ~15 minutes, one-time setup

2. **Test in Staging** (Recommended)
   - Verify all features work
   - Monitor usage patterns
   - Check error handling

3. **Deploy to Production** (Final)
   - Follow deployment checklist
   - Set up monitoring alerts
   - Configure backup strategy

4. **Complete Phase 10** (Optional but Recommended)
   - Setup CI/CD (GitHub Actions)
   - Configure error tracking (Sentry)
   - Enable performance monitoring

## Troubleshooting

### Issue: "Permission denied" errors
**Solution**: Check Firestore security rules in `firestore.rules`

### Issue: High read counts despite caching
**Solution**: Check cache hit rates in `Usage Monitor` and verify pagination is working

### Issue: App won't load user data
**Solution**: 
1. Verify users collection has documents
2. Check Firebase authentication is working
3. Review console for error messages

## Reference Files

- **Import Script**: `setupFirebase.mjs`
- **Import Data**: `data/users.json`, `data/settings.json`
- **Configuration**: `firebase/firebaseConfig.ts`
- **Rules**: `firestore.rules`
- **Guides**: 
  - `FIREBASE_BEST_PRACTICES.md`
  - `COMPOSITE_INDEXES_GUIDE.md`
  - `PHASES_4-9_COMPLETION_REPORT.md`

---

**Status**: ✅ Database cleaned and ready for import  
**Last Updated**: December 2, 2025  
**Project**: AccreditEx v1.0
